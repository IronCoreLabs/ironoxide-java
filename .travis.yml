language: rust
cache:
  directories:
    - "$HOME/.cargo"
    - "$HOME/.ivy2/cache"
    - "$HOME/.sbt/boot/"
    - "$HOME/bin"
# hopefully prevent the cache from becoming huge - https://levans.fr/rust_travis_cache.html
before_cache:
  - rm -rf /home/travis/.cargo/registry
rust:
  - 1.34.0
branches:
  only:
    - master
before_install:
  - openssl aes-256-cbc -K $encrypted_88ddd083498a_key -iv $encrypted_88ddd083498a_iv
    -in tests/src/test/resources/service-keys.conf.enc -out java/scala/src/test/resources/service-keys.conf -d
install:
  - "~/bin/sbt --help || curl -Ls https://git.io/sbt > ~/bin/sbt && chmod 0755 ~/bin/sbt"
before_script:
  - rustup component add rustfmt-preview
  - cross --version || cargo install cross
matrix:
  include:
    # Linux
    - name: Travis Default Environment (Ubuntu Linux)
      os: linux
    # OSX
    - name: OSX x86_64
      os: osx
    # iOS
    - name: iOS x64
      os: osx
      env:
        - JAVA_HOME=$(/usr/libexec/java_home)
        - TARGET=aarch64-apple-ios
        - IOS=1
    # Android
    - name: Android x64
      os: linux
      env:
        - TARGET=aarch64-linux-android
script:
  - "./.travis_scripts/cross-test.sh"
